function enableVerifyButton(){var e=!1;const t=$('input[name="nationality_type"]:checked').val();var n=$('input[name="etin_number"]').val(),i=$('input[name="user_DOB"]').val();if("foreign"==t){const a=$('input[name="identity_type_foreign"]:checked').val();"tin"==a?n&&i&&(e=!0):"passport"==a&&(e=!0)}else if("bangladeshi"==t){const o=$('input[name="identity_type_bd"]:checked').val();if("nid"==o){const s=$('input[name="user_nid"]').val();s&&i&&(e=!0)}else"tin"==o&&n&&i&&(e=!0)}e?$("#nid_tin_verify").prop("disabled",!1):$("#nid_tin_verify").prop("disabled",!0)}function verifyNID(){var e=document.getElementById("user_nid").value,t=document.getElementById("user_DOB").value,n=$(".errorMsgNID");$(".successMsgNID");(""==e||""==t)&&alert("Invalid National ID No. or Date of Birth");var i=e.length;10===i||13===i||17===i?$.ajax({url:"/client/signup/identity-verify/nid-verify",type:"GET",data:{_token:$('input[name="_token"]').val(),nid_number:e,user_DOB:t},datatype:"json",success:function(e){var t=document.getElementById("NIDVerificationTimeCounting");"error"===e.status&&(t.style.display="none",n.hide().empty(),"object"==typeof e.message?$.each(e.message,function(e,t){n.removeClass("hidden").append("<li>"+t+"</li>")}):n.removeClass("hidden").html(e.message),$("#NIDVerificationResponse").slideUp("slow",function(){n.slideDown("slow")})),"success"===e.status&&(101===e.statusCode?(t.style.display="none",document.getElementById("NIDVerificationResponse").innerHTML="Congrats!!! Your NID is valid.",$("#NIDVerificationResponse").delay(1e3).slideUp(1e3,function(){$("#VerifiedNIDInfo").slideDown("slow"),document.getElementById("nid_image").setAttribute("src","data:image/jpeg;base64,"+e.data.photo),document.getElementById("nid_name").innerHTML=e.data.nameEn;var t=new Date(e.data.dob);document.getElementById("nid_dob").innerHTML=t.getDate()+"-"+t.toLocaleString("default",{month:"short"})+"-"+t.getFullYear(),document.getElementById("SaveContinueBtn").classList.remove("hidden")})):(NIDVerifyTimeCount()>180?document.getElementById("NIDVerificationResponse").innerHTML='<i class="fa fa-spinner fa-spin"></i> Its been 3 minute already!<br />We will try to verify for you, when server is available<br /><b>You can try again after some time...</b>':999===e.statusCode?document.getElementById("NIDVerificationResponse").innerHTML='<i class="fa fa-spinner fa-spin"></i> Your national ID information has been sent for verification, please wait...':777===e.statusCode?document.getElementById("NIDVerificationResponse").innerHTML='<i class="fa fa-spinner fa-spin"></i> Your national ID information has been sent to EC Server. Please wait for some more time...':document.getElementById("NIDVerificationResponse").innerHTML='<i class="fa fa-spinner fa-spin"></i> Waiting for response from the national ID server. Please wait...',document.getElementById("NIDVerifyTimeSpent").innerHTML=NIDVerifyTimeCount(),setRecursionForNIDVerification=setTimeout(verifyNID,8e3)))},error:function(e,t,i){n.hide().empty(),n.removeClass("hidden").html(i),$("#NIDVerificationResponse").slideUp("slow",function(){n.slideDown("slow")}),clearTimeout(setRecursionForNIDVerification)},beforeSend:function(){}}):$("#NIDVerificationResponse").slideUp("slow",function(){n.hide().empty(),n.removeClass("hidden").html("Invalid NID length. It should be 10, 13 or 17 digits."),n.slideDown("slow")})}function NIDVerifyTimeCount(){var e=new Date;return Math.floor((e-submit_time)/1e3)}function verifyETIN(){var e=document.getElementById("etin_number").value,t=document.getElementById("user_DOB").value,n=$(".errorMsgTIN");$(".successMsgTIN");(""==e||""==t)&&alert("Invalid ETIN No. or Date of Birth");var i=e.length;i>=10&&15>=i?$.ajax({url:"client/signup/identity-verify/etin-verify",type:"GET",data:{_token:$('input[name="_token"]').val(),etin_number:e,user_DOB:t},datatype:"json",success:function(e){if("error"===e.status&&(n.hide().empty(),"object"==typeof e.message?$.each(e.message,function(e,t){n.removeClass("hidden").append("<li>"+t+"</li>")}):n.removeClass("hidden").html(e.message),$("#ETINResponseCountMsg").slideUp("slow",function(){n.slideDown("slow")})),"success"===e.status){var t=document.getElementById("ETINVerifySuccessMsg");t.style.display="none",document.getElementById("ETINResponseCountMsg").innerHTML="Congrats!!! Your ETIN is valid.",$("#ETINResponseCountMsg").delay(1e3).slideUp(1e3,function(){$("#VerifiedETINInfo").slideDown("slow"),document.getElementById("etin_name").innerHTML=e.data.nameEn,document.getElementById("etin_father_name").innerHTML=e.data.father_name;var t=new Date(e.data.dob);document.getElementById("etin_dob").innerHTML=t.getDate()+"-"+t.toLocaleString("default",{month:"short"})+"-"+t.getFullYear(),document.getElementById("etinSaveContinueBtn").classList.remove("hidden")})}},error:function(e,t,i){n.hide().empty(),n.removeClass("hidden").html(i),$("#ETINResponseCountMsg").slideUp("slow",function(){n.slideDown("slow")}),clearTimeout(setRecursionForETINVerification)},beforeSend:function(){}}):$("#ETINResponseCountMsg").slideUp("slow",function(){n.hide().empty(),n.removeClass("hidden").html("The e-tin number must be between 10 and 15 digits."),n.slideDown("slow")})}function ETINVerifyTimeCount(){var e=new Date;return Math.floor((e-submit_time)/1e3)}function submitIdentityVerifyForm(e){document.forms[e].submit()}function getSelectedIdentityType(){var e,t=document.querySelector('input[name="nationality_type"]:checked').value;return"bangladeshi"===t?e=document.querySelector('input[name="identity_type_bd"]:checked').value:"foreign"===t&&(e=document.querySelector('input[name="identity_type_foreign"]:checked').value),e}function setUserNationality(e){"bangladeshi"===e?($("#bd_nationality_fields").fadeIn(),document.getElementById("foreign_nationality_fields").style.display="none",$('input[name="identity_type_foreign"]').prop("checked",!1)):"foreign"===e?($("#foreign_nationality_fields").fadeIn(),document.getElementById("bd_nationality_fields").style.display="none",$('input[name="identity_type_bd"]').prop("checked",!1)):(document.getElementById("foreign_nationality_fields").style.display="none",document.getElementById("bd_nationality_fields").style.display="none"),setUserIdentity()}function setUserIdentity(e){if("nid"===e)$("#nid_field").fadeIn(),document.getElementById("user_nid").value="",$("#user_dob_field").fadeIn(),document.getElementById("user_DOB").value="",document.getElementById("etin_number_field").style.display="none",document.getElementById("passport_div").style.display="none",$("#passport_verify").hide(),$("#nid_tin_verify").show();else if("tin"===e)$("#etin_number_field").fadeIn(),document.getElementById("etin_number").value="",document.getElementById("nid_field").style.display="none",$("#user_dob_field").fadeIn(),document.getElementById("user_DOB").value="",document.getElementById("passport_div").style.display="none",$("#passport_verify").hide(),$("#nid_tin_verify").show();else if("passport"===e){$("#passport_div").fadeIn(),document.getElementById("nid_field").style.display="none",document.getElementById("nid_field").disabled=!0,document.getElementById("user_dob_field").style.display="none",document.getElementById("user_dob_field").disabled=!0,document.getElementById("etin_number_field").style.display="none",document.getElementById("etin_number_field").disabled=!0,$("#passport_verify").hide(),$("#nid_tin_verify").hide();var t=$("#sample_passport").height()+"px";$("#sample_passport_text").css("height",t)}else document.getElementById("passport_div").style.display="none",document.getElementById("nid_field").style.display="none",document.getElementById("user_dob_field").style.display="none",document.getElementById("etin_number_field").style.display="none",$("#passport_verify").hide(),$("#nid_tin_verify").show(),$("#nid_tin_close").hide(),$("#passport_logout").show()}function initPassportCropper(){cropper=new Cropper(image,{viewMode:1,ready:function(){is_passport_croped="no"},crop:function(e){is_passport_croped="yes"}}),document.getElementById("passport_preloader").style.display="none"}function getPassportImage(e){if(e.files&&e.files[0]){$("#passport_upload_error").html("");var t=window.URL||window.webkitURL,n=new Image;n.src=t.createObjectURL(e.files[0]),n.onload=function(){(4500<this.height||3500<this.width||1043>this.height||746>this.width)&&$("#passport_upload_error").html('<div class="alert alert-warning fade in" role="alert"><h4>Warning! Better check yourself. </h4><p>The passport image resolution minimum <strong>746X1043</strong> pixel and maximum <strong>3500X4500</strong> pixel is suitable for verify. You have given <strong>'+this.width+"x"+this.height+" </strong> pixel.</p></div>")};var i=e.files[0].type;if("image/jpeg"!=i&&"image/jpg"!=i&&"image/png"!=i)return $("#passport_upload_error").html('<div class="alert alert-danger fade in" role="alert"><h4>Oh snap! You got an error!</h4><p>The passport format is not valid. Only PNG, JPEG, or JPG type is allowed.</p></div>'),!1;if(!(e.files[0].size<=5242880))return $("#passport_upload_error").html('<div class="alert alert-danger fade in" role="alert"><h4>Oh snap! You got an error!</h4><p>The passport size maximum of 5 MB.</p></div>'),!1;document.getElementById("passport_upload_div").style.display="none",document.getElementById("passport_preloader").style.display="block";var a=new FileReader;a.onload=function(t){$("#passport_upload_view").attr("src",t.target.result),$("#passport_upload_base_code").val(t.target.result),$("#passport_file_name").val(e.files[0].name),$("#passport_upload_manual_file").val(t.target.result),$("#magnify_image_large").css({"background-image":"url("+t.target.result+")","background-repeat":"no-repeat"}),$("#magnify_image_small").attr("src",t.target.result),document.getElementById("passport_upload_view_wrapper").style.display="block"},a.readAsDataURL(e.files[0]),setTimeout(initPassportCropper,1e3)}}$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$(document).ready(function(){enableVerifyButton(),$('input[name="nationality_type"]').on("change",enableVerifyButton),$('input[name="identity_type_bd"]').on("change",enableVerifyButton),$('input[name="identity_type_foreign"]').on("change",enableVerifyButton),$("#etin_number").on("keyup",enableVerifyButton),$("#user_DOB").on("keyup",enableVerifyButton),$(".userDP").on("dp.change",enableVerifyButton),$("#user_nid").on("keyup",enableVerifyButton);var e=new Date,t=e.getFullYear();$(".userDP").datetimepicker({viewMode:"years",format:"DD-MMM-YYYY",maxDate:"now",minDate:"01/01/"+(t-110)}),$(".passportDP").datetimepicker({viewMode:"years",format:"DD-MMM-YYYY",maxDate:"now",minDate:"01/01/"+(t-110)}),$(".passExpiryDate").datetimepicker({viewMode:"years",format:"DD-MMM-YYYY",maxDate:"01/01/"+(t+20),minDate:"01/01/"+(t-10)}),$("#identityVerifyForm").validate({errorPlacement:function(){return!1},submitHandler:function(e){var t=getSelectedIdentityType();return"nid"===t?($("#NIDVerifyModal").modal("show"),!1):"tin"===t?($("#ETINVerifyModal").modal("show"),!1):"passport"!==t?(alert("Sorry! unknown identity type"),!1):void e.submit()}}),$("#NIDVerifyModal").on("shown.bs.modal",function(){document.getElementById("NIDVerificationTimeCounting").style.display="block",$("#NIDVerificationResponse").slideDown("slow",function(){$("#NIDVerificationResponse").html('<i class="fa fa-spinner fa-spin"></i> Waiting for the connection to the national ID server.....'),submit_time=new Date,verifyNID()})}),$("#NIDVerifyModal").on("hidden.bs.modal",function(){document.getElementById("NIDVerificationResponse").innerHTML="",document.getElementById("VerifiedNIDInfo").style.display="none",document.getElementById("nid_image").setAttribute("src",""),document.getElementById("nid_name").innerHTML="",document.getElementById("nid_dob").innerHTML="",document.getElementById("SaveContinueBtn").classList.add("hidden"),$(".errorMsgNID").slideUp(),clearTimeout(setRecursionForNIDVerification),location.reload()}),$("#ETINVerifyModal").on("shown.bs.modal",function(){$("#ETINResponseCountMsg").slideDown("slow",function(){$("#ETINResponseCountMsg").html('<i class="fa fa-spinner fa-spin"></i> Waiting for the connection to the NBR server.....'),submit_time=new Date,verifyETIN()})}),$("#ETINVerifyModal").on("hidden.bs.modal",function(){document.getElementById("ETINResponseCountMsg").innerHTML="",document.getElementById("VerifiedETINInfo").style.display="none",document.getElementById("etin_name").innerHTML="",document.getElementById("etin_dob").innerHTML="",document.getElementById("etinSaveContinueBtn").classList.add("hidden"),$("#ETINVerifyModal .errorMsgTIN").slideUp(),clearTimeout(setRecursionForNIDVerification)})});var setRecursionForNIDVerification,setRecursionForETINVerification,submit_time,submit_time,cropper,canvas,is_passport_croped,image=document.getElementById("passport_upload_view");$("#passport_reset_btn").click(function(){cropper.destroy(),cropper=null,$("#passport_upload_base_code").val(""),$("#passport_file_name").val(""),$("#passport_upload_manual_file").val(""),$("#passport_cropped_result").html(""),$("#passport_upload").val(""),$("#passport_upload_view").attr("src","#"),$("div.cropper-container").remove(),document.getElementById("passport_upload_view_div").style.display="block",document.getElementById("passport_edit_btn").style.display="none",document.getElementById("passport_crop_btn").style.display="block",document.getElementById("passport_upload_view_wrapper").style.display="none",document.getElementById("passport_upload_div").style.display="block",$("#passport_verify").hide()}),$("#passport_edit_btn").click(function(){$("#passport_verify").hide(),document.getElementById("passport_cropped_result").style.display="none",document.getElementById("passport_edit_btn").style.display="none",document.getElementById("passport_upload_view_div").style.display="block",document.getElementById("passport_crop_btn").style.display="block"}),$("#passport_crop_btn").click(function(){if("no"==is_passport_croped)return swal({type:"error",title:"Oops...",text:"Please follow the instruction shown on the right side, and position the rectangular properly to crop your proper passport image."}),!1;document.getElementById("passport_preloader").style.display="block",document.getElementById("passport_upload_view_div").style.display="none",document.getElementById("passport_crop_btn").style.display="none",canvas=cropper.getCroppedCanvas({width:1492,height:2087}).toDataURL("image/jpeg",.7);var e=$("#passport_file_name").val();$("#passport_upload_base_code").val(canvas),document.getElementById("passport_cropped_result").style.display="block",$("#passport_cropped_result").html(""),$("#passport_cropped_result").html('<div style="padding: 10px 15px;" class="panel-heading"><h3 class="panel-title">File name: '+e+'</h3></div><div class="panel-body"><img alt="Passport copy" src="'+canvas+'" /></div>'),document.getElementById("passport_edit_btn").style.display="block",$("#magnify_image_large").css({"background-image":"url("+canvas+")","background-repeat":"no-repeat"}),$("#magnify_image_small").attr("src",canvas),$("#passport_verify").show(),toastr.success("Passport cropped and resized."),document.getElementById("passport_preloader").style.display="none"}),$(document).ready(function(){$("#passport_error_retry").on("click",function(){$("#PassportErrorModal").modal("hide"),$("#passport_reset_btn").trigger("click")}),$("#passport_error_manual").on("click",function(){$("#PassportErrorModal").modal("hide");var e=$("#passport_file_name").val(),t=$("#passport_upload_manual_file").val();$("#passport_file_name_show").text(e),$("#magnify_image_large").css({"background-image":"url("+t+")","background-repeat":"no-repeat"}),$("#magnify_image_small").attr("src",t),document.getElementById("passport_upload_wrapper").style.display="none",$("#preloader").hide().html(""),document.getElementById("passport_div_verification").style.display="block",$("#passport_verify").hide(),$("#nid_tin_verify").show().text("Submit")}),$("#passport_verify").on("click",function(){$("#preloader").show().html('<i class="fas fa-spinner fa-pulse"></i>');var e=$("#passport_upload_base_code").val();return e?void $.ajax({url:"client/signup/getPassportData",type:"POST",dataType:"text",data:{_token:$('input[name="_token"]').val(),file:e,photo:"yes"},success:function(e){var t=JSON.parse(e);if("200"==t.code){document.getElementById("passport_no").value=t.data.document_number,$("#passport_nationality").val(t.nationality_id).change(),$("#passport_type").val(t.data.document_type.toLowerCase()).change();var n=new Date(t.data.birth_date),i=new Date(t.data.expiry_date);document.getElementById("passport_surname").value=t.data.surname,document.getElementById("passport_given_name").value=t.data.name,document.getElementById("passport_personal_no").value=t.data.optional_data,document.getElementById("passport_DOB").value=n.getDate()+"-"+n.toLocaleString("default",{month:"short"})+"-"+n.getUTCFullYear(),document.getElementById("passport_date_of_expire").value=i.getDate()+"-"+i.toLocaleString("default",{month:"short"})+"-"+i.getUTCFullYear(),document.getElementById("passport_upload_wrapper").style.display="none",$("#preloader").hide().html(""),document.getElementById("passport_div_verification").style.display="block",$("#passport_verify").hide();var a=$("#passport_file_name").val();$("#passport_upload_manual_file").val(""),$("#passport_file_name_show").text(a),$("#nid_tin_verify").show().text("Submit"),$("#nid_tin_close").show(),document.getElementById("passport_logout").style.display="none"}else $("#preloader").hide().html(""),$("#PassportErrorModal").modal("show")}}):!1}),$("#nid_tin_close").on("click",function(){location.reload()});var e=0,t=0,n=!0,i=null;$(".magnify").mousemove(function(a){if(e||t){var o=$(this).offset(),s=a.pageX-o.left,r=a.pageY-o.top;if(s<$(this).width()&&r<$(this).height()&&s>0&&r>0?$(this).children(".large").fadeIn(100):$(this).children(".large").fadeOut(100),$(this).children(".large").is(":visible")){var d=-1*Math.round(s/$(this).children(".small").width()*e-$(this).children(".large").width()/2),l=-1*Math.round(r/$(this).children(".small").height()*t-$(this).children(".large").height()/2),p=d+"px "+l+"px",m=s-$(this).children(".large").width()/2,u=r-$(this).children(".large").height()/2;$(this).children(".large").css({left:m,top:u,backgroundPosition:p})}}else n&&(n=!1,i=new Image,i.src=$(this).children(".small").attr("src")),e=i.width,t=i.height}).on("mouseleave",function(){e=0,t=0,n=!0})});